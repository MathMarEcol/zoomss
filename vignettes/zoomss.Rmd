---
title: "Getting started with ZooMSS"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{zoomss}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
options(rmarkdown.html_vignette.check_title = FALSE)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(zoomss)
```


## How to run ZooMSS

### Input Data

ZooMSS requires two sets of input data:

1. **Group** - Contains all taxa-specific parameter values, including size ranges and functional group properties.

2. **Environmental data** - A Time-series dataframe with time series of environmental conditions  with `time`, `sst`, and `chl` columns.

### Running the default Model

Get the default published `Groups` dataframe using:

```{r}
Groups <- getGroups()
```

Now create an environmental data time-series using the helper function. This time-series uses a constant sea surface temperature (`sst`) and chlorophyll *a*  (`chl`) with a 0.1 yr-1 timestep (`dt`). 

```{r}
env_data <- createInputParams(time = seq(0, 100, by = 0.1) ,
                              sst = 15,
                              chl = 0.15)

```

Now we run ZooMSS and save every `isave` timestep to reduce storage requirements. 
```{r}
mdl <- zoomss_model(input_params = env_data, Groups = Groups, isave = 2)

```

### Plotting

The model includes several built-in plotting functions for analysis and visualization.


#### Time Series Analysis

These plots display total abundance and mean growth/mortality across all size classes through time.

```{r}

library(patchwork)
p1 <- plotTimeSeries(mdl, by = "abundance") # Plot abundance time series
p2 <- plotTimeSeries(mdl, by = "growth") # Plot growth rate time series
p3 <- plotTimeSeries(mdl, by = "mortality") # Plot predation mortality time series

p1/p2/p3


```


We can also plot total biomass through time.

```{r}
p1 <- plotTimeSeries(mdl, by = "biomass") # Plot biomass 
p2 <- plotTimeSeries(mdl, by = "biomass", stacked = TRUE) # Plot stacked biomass 
p3 <- plotTimeSeries(mdl, by = "biomass", stacked = TRUE, proportion = TRUE) # Plot proportional stacked biomass 


```
#### Static Plots

Plot mean species-resolved size spectra for the final `n_years`.
```{r}
plotSizeSpectra(mdl, n_years = 10)

```

Plot predator-prey mass ratios for the `idx` timestep
```{r}
plotPPMR(mdl, idx = 500) # Plot final timestep
```
